<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Block Encoder / Decoder (Keyed)</title>

<style>
body {
  font-family: sans-serif;
  max-width: 720px;
  margin: auto;
  padding: 20px;
}

textarea, input, button {
  width: 100%;
  margin-top: 6px;
  padding: 8px;
  font-size: 16px;
}

textarea {
  height: 80px;
}

label {
  margin-top: 12px;
  display: block;
  font-weight: bold;
}
</style>
</head>

<body>

<h2>Block Encoder / Decoder (with Key)</h2>

<label>Encryption Key (optional)</label>
<input id="keyInput" placeholder="Enter key">

<label>Text to Encode</label>
<textarea id="textInput"></textarea>

<button id="encodeBtn">Encode</button>

<label>Encoded Blocks</label>
<textarea id="encodedOutput"></textarea>

<button id="copyEncodedBtn">Copy Encoded</button>

<button id="decodeBtn">Decode</button>

<label>Decoded Text</label>
<textarea id="decodedOutput"></textarea>

<button id="copyDecodedBtn">Copy Decoded</button>

<script>
// ================= CONFIG =================

// Paste your big blockChars array here
const blockChars = [
  // Block Elements U+2580–U+259F
  "▀","▁","▂","▃","▄","▅","▆","▇","█","▉","▊","▋","▌","▍","▎","▏",
  "▐","░","▒","▓","▔","▕","▖","▗","▘","▙","▚","▛","▜","▝","▞","▟",
  // Box Drawing U+2500–U+257F (common visible ones)
  "─","│","┌","┐","└","┘","├","┤","┬","┴","┼","═","║","╔","╗","╚","╝","╠","╣","╦","╩","╬",
  // Geometric Shapes U+25A0–U+25FF (selected)
  "■","□","▢","▣","▤","▥","▦","▧","▨","▩","▪","▫","▬","▭","▮","▯",
  "▲","△","▴","▵","▶","▷","▸","▹","▼","▽","▾","▿","◀","◁","◂","◃",
  "◆","◇","◈","◉","◊","○","◌","◍","◐","◑","◒","◓","◔","◕","◖","◗",
  "◘","◙","◚","◛","◜","◝","◞","◟","◠","◡","◢","◣","◤","◥","◦","◧",
  "◨","◩","◪","◫","◬","◭","◮","◯",
  // Braille Patterns U+2800–U+28FF (all 256)
  "⠀","⠁","⠂","⠃","⠄","⠅","⠆","⠇","⠈","⠉","⠊","⠋","⠌","⠍","⠎","⠏",
  "⠐","⠑","⠒","⠓","⠔","⠕","⠖","⠗","⠘","⠙","⠚","⠛","⠜","⠝","⠞","⠟",
  "⠠","⠡","⠢","⠣","⠤","⠥","⠦","⠧","⠨","⠩","⠪","⠫","⠬","⠭","⠮","⠯",
  "⠰","⠱","⠲","⠳","⠴","⠵","⠶","⠷","⠸","⠹","⠺","⠻","⠼","⠽","⠾","⠿",
  "⡀","⡁","⡂","⡃","⡄","⡅","⡆","⡇","⡈","⡉","⡊","⡋","⡌","⡍","⡎","⡏",
  "⡐","⡑","⡒","⡓","⡔","⡕","⡖","⡗","⡘","⡙","⡚","⡛","⡜","⡝","⡞","⡟",
  "⡠","⡡","⡢","⡣","⡤","⡥","⡦","⡧","⡨","⡩","⡪","⡫","⡬","⡭","⡮","⡯",
  "⡰","⡱","⡲","⡳","⡴","⡵","⡶","⡷","⡸","⡹","⡺","⡻","⡼","⡽","⡾","⡿",
  "⢀","⢁","⢂","⢃","⢄","⢅","⢆","⢇","⢈","⢉","⢊","⢋","⢌","⢍","⢎","⢏",
  "⢐","⢑","⢒","⢓","⢔","⢕","⢖","⢗","⢘","⢙","⢚","⢛","⢜","⢝","⢞","⢟",
  "⢠","⢡","⢢","⢣","⢤","⢥","⢦","⢧","⢨","⢩","⢪","⢫","⢬","⢭","⢮","⢯",
  "⢰","⢱","⢲","⢳","⢴","⢵","⢶","⢷","⢸","⢹","⢺","⢻","⢼","⢽","⢾","⢿",
  "⣀","⣁","⣂","⣃","⣄","⣅","⣆","⣇","⣈","⣉","⣊","⣋","⣌","⣍","⣎","⣏",
  "⣐","⣑","⣒","⣓","⣔","⣕","⣖","⣗","⣘","⣙","⣚","⣛","⣜","⣝","⣞","⣟",
  "⣠","⣡","⣢","⣣","⣤","⣥","⣦","⣧","⣨","⣩","⣪","⣫","⣬","⣭","⣮","⣯",
  "⣰","⣱","⣲","⣳","⣴","⣵","⣶","⣷","⣸","⣹","⣺","⣻","⣼","⣽","⣾","⣿"
];

// Allowed characters (expand as desired)
const allowedChars =
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 !@#$%^&*()-_=+/?.,:\"'<>[]{}\\|;\n\t";

// ================= UTIL =================

const keyInput = document.getElementById("keyInput");

keyInput.value = localStorage.getItem("blockEncoderKey") ?? "";

function hashString(str) {
  let h = 2166136261 >>> 0;
  for (let i = 0; i < str.length; i++) {
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}

function getKeyedBlockChars() {
  const key = keyInput.value || "";
  if (!key) return blockChars;

  const offset = hashString(key) % blockChars.length;
  return blockChars.slice(offset).concat(blockChars.slice(0, offset));
}

// ================= ENCODE =================

function encodeToBlocks(input) {
  const keyedBlocks = getKeyedBlockChars();

  const bitsPerChar = Math.ceil(Math.log2(allowedChars.length));
  const bitsPerBlock = Math.floor(Math.log2(keyedBlocks.length));

  let bitBuffer = 0;
  let bitLength = 0;
  let result = "";

  function flush() {
    if (bitLength > 0) {
      const idx =
        (bitBuffer << (bitsPerBlock - bitLength)) &
        ((1 << bitsPerBlock) - 1);
      result += keyedBlocks[idx];
      bitBuffer = 0;
      bitLength = 0;
    }
  }

  for (const c of input) {
    const val = allowedChars.indexOf(c);

    if (val === -1) {
      flush();
      result += c;
      continue;
    }

    bitBuffer = (bitBuffer << bitsPerChar) | val;
    bitLength += bitsPerChar;

    while (bitLength >= bitsPerBlock) {
      bitLength -= bitsPerBlock;
      const idx =
        (bitBuffer >> bitLength) &
        ((1 << bitsPerBlock) - 1);
      result += keyedBlocks[idx];
    }
  }

  flush();
  return result;
}

// ================= DECODE =================

function decodeFromBlocks(str) {
  const keyedBlocks = getKeyedBlockChars();
  const keyedBlockToIndex = Object.fromEntries(
    keyedBlocks.map((b, i) => [b, i])
  );

  const bitsPerChar = Math.ceil(Math.log2(allowedChars.length));
  const bitsPerBlock = Math.floor(Math.log2(keyedBlocks.length));

  let bitBuffer = 0;
  let bitLength = 0;
  let result = "";

  function flush() {
    bitBuffer = 0;
    bitLength = 0;
  }

  for (const c of str) {
    const val = keyedBlockToIndex[c];

    if (val === undefined) {
      flush();
      result += c;
      continue;
    }

    bitBuffer = (bitBuffer << bitsPerBlock) | val;
    bitLength += bitsPerBlock;

    while (bitLength >= bitsPerChar) {
      bitLength -= bitsPerChar;
      const idx =
        (bitBuffer >> bitLength) &
        ((1 << bitsPerChar) - 1);
      result += allowedChars[idx];
    }
  }

  return result;
}

// ================= UI =================

const textInput = document.getElementById("textInput");
const encodedOutput = document.getElementById("encodedOutput");
const decodedOutput = document.getElementById("decodedOutput");

document.getElementById("encodeBtn").onclick = () => {
  localStorage.setItem("blockEncoderKey", keyInput.value);
  encodedOutput.value = encodeToBlocks(textInput.value);
};

document.getElementById("decodeBtn").onclick = () => {
  localStorage.setItem("blockEncoderKey", keyInput.value);
  decodedOutput.value = decodeFromBlocks(encodedOutput.value);
};

document.getElementById("copyEncodedBtn").onclick = () => {
  encodedOutput.select();
  document.execCommand("copy");
};

document.getElementById("copyDecodedBtn").onclick = () => {
  decodedOutput.select();
  document.execCommand("copy");
};

</script>

</body>
</html>
